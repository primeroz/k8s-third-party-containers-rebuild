---
name: 'dockerhub-build'
description: 'Build Dockerfile Images for dockerhub'
inputs:
  context:
    description: 'Directory containing Dockerfile'
    required: true
  tags:
    description: 'image repository/tag for the image'
    required: true
runs:
  using: "composite"
  steps:
    -
      name: Set up QEMU
      uses: docker/setup-qemu-action@v1
    -
      name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v1
    -
      name: Login to DockerHub
      uses: docker/login-action@v1
      with:
        username: ${{ secrets.DOCKERHUB_USERNAME }}
        password: ${{ secrets.DOCKERHUB_TOKEN }}

    -
      name: Build and Push
      uses: docker/build-push-action@v2
      with:
        push: false
        tags: ${{ inputs.tags }}
        context: ${{ inputs.context }}

    -
      name: Image digest
      run: echo ${{ steps.docker_build.outputs.digest }}
